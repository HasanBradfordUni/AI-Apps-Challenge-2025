{% extends "base.html" %}

{% block title %}Has AI - General AI Chatbot Hub{% endblock %}

{% block header_title %}General AI Chatbot Hub - Home{% endblock %}

{% block content %}
<!-- Pass data from Flask to JavaScript -->
<script type="text/javascript">
    // Make Flask data available to JavaScript
    window.PROMPT_MODES = JSON.parse(`{{ prompt_modes | tojson | safe | replace("'", "\\'") }}`);
    window.AVAILABLE_APPS = JSON.parse(`{{ available_apps | tojson | safe | replace("'", "\\'") }}`);
</script>

<!-- Sidebar -->
<div class="sidebar">
    <div class="mode-selector">
        <h3>ğŸ¯ Prompt Mode</h3>
        <select id="promptMode" onchange="changeMode()" class="mode-dropdown">
            {% for mode_id, mode in prompt_modes.items() %}
            <option value="{{ mode_id }}" {% if mode_id == 'general' %}selected{% endif %}>
                {{ mode.icon }} {{ mode.name }}
            </option>
            {% endfor %}
        </select>
        <p id="modeDescription" class="mode-desc">
            {{ prompt_modes.general.description }}
        </p>
    </div>

    <div class="quick-apps">
        <h3 style="grid-column: 1 / -1;">ğŸš€ Quick Apps</h3>
        {% for app_id, app in available_apps.items() %}
        <div class="quick-app" onclick="suggestApp('{{ app_id }}')">
            <strong>{{ app.icon }} {{ app.name }}</strong>
            <p>{{ app.description }}</p>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Main Chat Area -->
<div class="main-chat">
    <!-- Chat Actions moved above chat header -->
    <div class="chat-actions">
        <button onclick="clearChat()" class="action-btn">ğŸ—‘ï¸ Clear Chat</button>
        <button onclick="exportChat()" class="action-btn">ğŸ“¥ Export</button>
        <button onclick="showHelp()" class="action-btn">â“ Help</button>
    </div>

    <div class="chat-header">
        <h2 class="mainHeading">General AI Assistant</h2>
        <div class="status-indicator">
            <span class="status-dot online"></span>
            <span class="subHeading">Online</span>
        </div>
    </div>

    <div class="chat-messages" id="chatMessages">
        <div class="message bot-message">
            <div class="message-content">
                <strong>ğŸ¤– AI Assistant:</strong>
                <p>Hello! I'm your AI assistant hub. I can help with general questions or direct you to specific AI apps. What would you like to do today?</p>
            </div>
            <div class="message-time" id="message-time"></div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
            <script>
                document.getElementById('message-time').textContent = moment().format('HH:mm');
            </script>
        </div>
    </div>

    <div class="chat-input-container">
        <div class="chat-input">
            <!-- File upload button -->
            <button onclick="openFileUpload()" class="input-action-btn" title="Upload files">
                ğŸ“ <span id="fileCount" style="display:none;"></span>
            </button>
            
            <!-- Voice recording button -->
            <button onclick="toggleVoiceRecording()" id="voiceBtn" class="input-action-btn" title="Voice input">
                ğŸ¤
            </button>
            
            <textarea id="messageInput" placeholder="Type your message here..." rows="2"></textarea>
            
            <button onclick="sendMessage()" id="sendButton">
                <span id="sendIcon">ğŸ“¤</span>
            </button>
        </div>
        
        <!-- Voice transcript display -->
        <div id="voiceTranscript" class="voice-transcript" style="display:none;">
            <div class="transcript-header">
                <span>ğŸ¤ Recording...</span>
                <button onclick="stopVoiceRecording()" class="stop-recording-btn">Stop</button>
            </div>
            <div id="transcriptText" class="transcript-text"></div>
        </div>
        
        <!-- File upload preview -->
        <div id="fileUploadPreview" class="file-upload-preview" style="display:none;">
            <div class="preview-header">
                <span>ğŸ“ Attached Files (<span id="uploadedCount">0</span>/10)</span>
                <span id="totalSize">0 MB / 1024 MB</span>
            </div>
            <div id="fileList" class="file-list"></div>
        </div>
        
        <div class="quick-suggestions">
            <button onclick="quickMessage('What can you help me with?')" class="suggestion">What can you do?</button>
            <button onclick="quickMessage('Show me available apps')" class="suggestion">Available Apps</button>
            <button onclick="quickMessage('Help me write something')" class="suggestion">Writing Help</button>
            <button onclick="quickMessage('I need coding help')" class="suggestion">Code Help</button>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" multiple accept="*/*" style="display:none;" onchange="handleFileSelection(event)">
</div>

<!-- App Suggestion Modal -->
<div id="appSuggestionModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ğŸ¯ App Suggestion</h3>
            <button onclick="closeModal()" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
            <p>I think this app might help with your request:</p>
            <div id="suggestedApp" class="suggested-app">
                <!-- App details will be populated here -->
            </div>
            <div class="modal-actions">
                <button onclick="goToApp()" class="primary-btn">Go to App</button>
                <button onclick="continueChat()" class="secondary-btn">Continue in Chat</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
{% endblock %}