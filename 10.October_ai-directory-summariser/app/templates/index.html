{% extends "base.html" %}

{% block title %}Has AI - Directory AI Summariser{% endblock %}

{% block content %}
<h1 class="mainHeading">üìÅ Analyze Directory</h1>

<div class="dashboard-container">
    <!-- Main Analysis Form -->
    <div class="dashboard-card">
        <form action="{{ url_for('analyze_directory') }}" method="POST" class="email-form">
            <input type="text" name="directory_path" placeholder="Enter directory path (e.g., C:\Documents)" class="email-input" required>
            <button type="submit" class="submit-btn">Analyze Directory</button>
        </form>
    </div>

    <!-- User Templates -->
    {% if user_templates %}
    <div class="dashboard-card">
        <h3 class="subHeading">üìé Your Templates ({{ user_templates|length }})</h3>
        <div class="quick-actions">
            {% for template in user_templates %}
            <div class="action-btn" style="background: rgba(0,100,0,0.8); cursor: default;">
                {{ template.category }} - {{ template.filename }}
            </div>
            {% endfor %}
        </div>
        <a href="{{ url_for('templates') }}" class="submit-btn">Manage Templates</a>
    </div>
    {% endif %}

    <!-- Current Analysis -->
    {% if current_analysis %}
    <div class="dashboard-card">
        <h3 class="subHeading">üìä Latest Analysis</h3>
        <p><strong>Path:</strong> {{ current_analysis.directory_path }}</p>
        <p><strong>Files:</strong> {{ current_analysis.total_files }} | <strong>Size:</strong> {{ (current_analysis.total_size / 1024 / 1024) | round(1) }} MB</p>
        <div class="quick-actions">
            <button onclick="window.location.href=`{{ url_for('view_analysis') }}`" class="action-btn">View Results</button>
            <button onclick="window.location.href=`{{ url_for('export_analysis', format='json') }}`" class="action-btn">Export</button>
        </div>
    </div>
    {% endif %}

    <!-- Recent Analyses -->
    <div class="dashboard-card">
        <h3 class="subHeading">üìà Recent Analyses</h3>
        {% if recent_summaries %}
            {% for summary in recent_summaries[:3] %}
            <div class="event-item">
                <div class="event-details">
                    {% if summary|length >= 4 %}
                        <h4>{{ summary[0].split('\\')[-1] or summary[0].split('/')[-1] }}</h4>
                        <p>{{ summary[1] }} files ‚Ä¢ {{ (summary[2] / 1024 / 1024) | round(1) }} MB</p>
                        <p class="event-location">{{ summary[3][:10] if summary[3] }}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p>No recent analyses.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

<style>
/* Progress overlay styles */
.progress-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.progress-content {
    background: white;
    padding: 40px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    max-width: 400px;
    width: 90%;
}

.progress-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #f3f3f3;
    border-top: 5px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.progress-message {
    font-size: 18px;
    font-weight: bold;
    color: #333;
    margin-bottom: 15px;
}

.progress-details {
    color: #666;
    font-size: 14px;
}

.progress-details p {
    margin: 5px 0;
}

/* Form validation styles */
.email-input.valid {
    border-color: #28a745;
    box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
}

.email-input.invalid {
    border-color: #dc3545;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
}

/* Button loading state */
button[disabled] {
    opacity: 0.6;
    cursor: not-allowed;
}
</style>